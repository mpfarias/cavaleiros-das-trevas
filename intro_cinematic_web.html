<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prólogo — Royal Lendle</title>
  <style>
    :root{
      --bg:#0a0b0f; --ink:#e8e6e3; --muted:#a7a6a2; --gold:#c6a869; --shadow:rgba(0,0,0,.6);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background: radial-gradient(1200px 600px at 50% 20%, #151822 0%, #0a0b0f 40%, #07080b 100%);color:var(--ink);font:400 18px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial;overflow:hidden;user-select:none}
    .screen{position:relative;inset:0;width:100%;height:100vh;display:grid;place-items:center}
    .vignette{position:absolute;inset:0;pointer-events:none;box-shadow:inset 0 0 180px 80px #000}
    .grain{position:absolute;inset:-20%;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.7" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="0.05"/></svg>');animation:grain 1.5s steps(6) infinite;mix-blend-mode:soft-light}
    @keyframes grain{to{transform:translate3d(-10px,10px,0)}}

    .particles{position:absolute;inset:0;overflow:hidden;pointer-events:none}
    .particle{position:absolute;width:2px;height:2px;background:rgba(255,255,255,.2);border-radius:50%;filter:blur(.5px);animation:fall linear forwards}
    @keyframes fall{from{transform:translateY(-10vh)} to{transform:translateY(110vh)}}

    .center{position:relative;max-width:900px;padding:40px;text-align:center}
    .line{opacity:0;transform:translateY(12px);filter:drop-shadow(0 8px 24px var(--shadow))}
    .line.show{opacity:1;transform:translateY(0);transition:opacity .8s ease, transform .8s ease}
    .line.big{font-size:clamp(24px,4.2vw,44px);letter-spacing:.02em;line-height:1.25}
    .line.mid{font-size:clamp(18px,2.6vw,26px);color:#d9d7d3}
    .line.small{font-size:clamp(16px,2vw,20px);color:var(--muted)}

    .topbar{position:absolute;top:12px;left:12px;right:12px;display:flex;justify-content:space-between;gap:8px}
    .btn{appearance:none;border:none;border-radius:999px;padding:10px 16px;background:rgba(255,255,255,.08);color:#eee;cursor:pointer;font-weight:600;letter-spacing:.02em;backdrop-filter:blur(4px);box-shadow:0 4px 18px rgba(0,0,0,.25)}
    .btn:hover{background:rgba(255,255,255,.14)}.btn:active{transform:translateY(1px)}

    .gate{position:absolute;inset:0;display:grid;place-items:center;background:linear-gradient(180deg, rgba(0,0,0,.75), rgba(0,0,0,.92));z-index:5}
    .gate .card{max-width:720px;text-align:center;padding:28px;border-radius:20px;background:linear-gradient(160deg, rgba(255,255,255,.06), rgba(255,255,255,.03));box-shadow:0 30px 100px rgba(0,0,0,.6);border:1px solid rgba(255,255,255,.1)}
    .gate h1{margin:0 0 8px;font-size:clamp(22px,3.5vw,38px)}
    .gate p{margin:0 0 18px;color:#d6d4cf}

    .end-cta{opacity:0;transform:translateY(10px);transition:.6s ease all;margin-top:18px}
    .end-cta.show{opacity:1;transform:translateY(0)}

    .footer-hint{position:absolute;bottom:12px;width:100%;text-align:center;color:#bdbbb6;font-size:14px;opacity:.8}
  </style>
</head>
<body>
  <div class="screen" id="screen">
    <div class="topbar">
      <button class="btn" id="btnSkip" title="Pular introdução">Pular</button>
      <button class="btn" id="btnReplay" title="Recomeçar">Rever</button>
    </div>

    <div class="particles" id="particles"></div>

    <div class="center" aria-live="polite" aria-atomic="true">
      <div id="lines"></div>
      <div class="end-cta" id="endCta">
        <button class="btn" id="btnStart">Iniciar Aventura</button>
      </div>
    </div>

    <div class="vignette"></div>
    <div class="grain"></div>

    <div class="footer-hint" id="hint">Pressione ESPAÇO para pular • ENTER para avançar • R para recomeçar</div>
  </div>

  <div class="gate" id="gate" role="dialog" aria-modal="true">
    <div class="card">
      <h1>Introdução</h1>
      <p>Ative o áudio e comece a narrativa de Royal Lendle.</p>
      <button class="btn" id="btnBegin">Começar</button>
    </div>
  </div>

  <script>
  const el = (sel) => document.querySelector(sel);
  const linesBox = el('#lines');
  const endCta = el('#endCta');
  const particles = el('#particles');
  const btnBegin = el('#btnBegin');
  const gate = el('#gate');

  function spawnParticles(){
    const count = 40; particles.innerHTML = '';
    for(let i=0;i<count;i++){
      const p = document.createElement('i');
      p.className = 'particle';
      p.style.left = Math.random()*100 + 'vw';
      p.style.animationDuration = (6 + Math.random()*8) + 's';
      p.style.opacity = 0.15 + Math.random()*0.35;
      p.style.top = (-10 - Math.random()*90) + 'vh';
      particles.appendChild(p);
    }
  }

  // ------- Áudio: real (URLs) com fallback WebAudio sintético -------
  let AC, master, noiseBuf;
  const CFG = {
    // Se quiser usar arquivos reais, defina window.INTRO_AUDIO = { music:"/assets/audio/musica.mp3", tavern:"/assets/audio/taverna.mp3", wind:"/assets/audio/vento.ogg", battle:"/assets/audio/batalha.ogg", steps:"/assets/audio/passos.ogg", mug:"/assets/audio/caneca.ogg", thunder:"/assets/audio/trovao.ogg", sword:"/assets/audio/espada.ogg" }
    sources: (window.INTRO_AUDIO||{})
  };

  const A = { tags:{},
    async load(){
      // carrega <audio> quando houver URL
      for(const [k,url] of Object.entries(CFG.sources)){
        const a = new Audio(url); a.preload='auto'; a.crossOrigin='anonymous'; a.volume = (k==='music'?0.4:(k==='tavern'?0.5:0.9));
        if(['music','tavern','wind','rain','battle'].includes(k)) a.loop = true;
        this.tags[k]=a; await new Promise(res=>{ a.addEventListener('canplaythrough', res, {once:true}); a.load(); });
      }
    },
    play(name, vol){ const a=this.tags[name]; if(a){ if(typeof vol==='number') a.volume=vol; a.currentTime=0; a.play(); } else FXS[name]?.(); },
    stop(name){ const a=this.tags[name]; if(a){ a.pause(); } },
    fade(name, to=0, dur=1200){ const a=this.tags[name]; if(!a) return; const from=a.volume; const steps=24; const dt=dur/steps; let i=0; const t=setInterval(()=>{ i++; a.volume = from + (to-from)*(i/steps); if(i>=steps){ clearInterval(t); if(to===0) a.pause(); } }, dt); }
  };

  function initAudio(){
    // Fallback sintetizado
    AC = new (window.AudioContext||window.webkitAudioContext)();
    master = AC.createGain(); master.gain.value = 0.85; master.connect(AC.destination);
    const len = AC.sampleRate * 2; noiseBuf = AC.createBuffer(1, len, AC.sampleRate);
    const data = noiseBuf.getChannelData(0); for(let i=0;i<len;i++) data[i] = (Math.random()*2-1) * 0.9;
  }

  const FXS = {
    _wind:null,
    wind(on=true){ if(A.tags.wind){ on?A.play('wind'):A.stop('wind'); return; }
      if(!AC) return; if(on && !this._wind){ const src=AC.createBufferSource(); src.buffer=noiseBuf; src.loop=true; const lp=AC.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value=400; const g=AC.createGain(); g.gain.value=.18; src.connect(lp).connect(g).connect(master); src.start(); this._wind={src,g}; } else if(!on && this._wind){ this._wind.gain.gain.exponentialRampToValueAtTime(0.0001, AC.currentTime+1.2); this._wind.src.stop(AC.currentTime+1.3); this._wind=null; } },
    boom(){ if(A.tags.boom) return A.play('boom',0.7); if(!AC) return; const o=AC.createOscillator(); o.type='sine'; const g=AC.createGain(); g.gain.setValueAtTime(0.0001, AC.currentTime); g.gain.exponentialRampToValueAtTime(0.6, AC.currentTime+0.01); g.gain.exponentialRampToValueAtTime(0.0001, AC.currentTime+0.6); o.frequency.setValueAtTime(68, AC.currentTime); o.connect(g).connect(master); o.start(); o.stop(AC.currentTime+0.65); },
    thunder(){ if(A.tags.thunder) return A.play('thunder',0.5); if(!AC) return; const src=AC.createBufferSource(); src.buffer=noiseBuf; const bp=AC.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=120; bp.Q.value=.6; const g=AC.createGain(); g.gain.value=0.0001; g.gain.exponentialRampToValueAtTime(0.6, AC.currentTime+0.02); g.gain.exponentialRampToValueAtTime(0.0001, AC.currentTime+2); src.connect(bp).connect(g).connect(master); src.start(); src.stop(AC.currentTime+2.1); },
    sword(){ if(A.tags.sword) return A.play('sword',0.7); if(!AC) return; const src=AC.createBufferSource(); src.buffer=noiseBuf; const hp=AC.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=1200; const g=AC.createGain(); g.gain.value=0.0001; g.gain.exponentialRampToValueAtTime(0.7, AC.currentTime+0.05); g.gain.exponentialRampToValueAtTime(0.0001, AC.currentTime+0.5); src.connect(hp).connect(g).connect(master); src.start(); src.stop(AC.currentTime+0.55); },
    mug(){ if(A.tags.mug) return A.play('mug',0.6); if(!AC) return; const o=AC.createOscillator(); o.type='square'; const g=AC.createGain(); g.gain.setValueAtTime(0.0001, AC.currentTime); g.gain.exponentialRampToValueAtTime(0.4, AC.currentTime+0.01); g.gain.exponentialRampToValueAtTime(0.0001, AC.currentTime+0.2); o.frequency.setValueAtTime(2200, AC.currentTime); o.connect(g).connect(master); o.start(); o.stop(AC.currentTime+0.22); },
    steps(){ if(A.tags.steps) return A.play('steps',0.5); if(!AC) return; const o=AC.createOscillator(); o.type='triangle'; const g=AC.createGain(); g.gain.setValueAtTime(0.0001, AC.currentTime); g.gain.exponentialRampToValueAtTime(0.25, AC.currentTime+0.02); g.gain.exponentialRampToValueAtTime(0.0001, AC.currentTime+0.18); o.frequency.setValueAtTime(110, AC.currentTime); o.connect(g).connect(master); o.start(); o.stop(AC.currentTime+0.2); },
    battle(){ if(A.tags.battle) return A.play('battle',0.35); if(!AC) return; const src=AC.createBufferSource(); src.buffer=noiseBuf; const bp=AC.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=300; bp.Q.value=1; const g=AC.createGain(); g.gain.value=0.0001; g.gain.exponentialRampToValueAtTime(0.25, AC.currentTime+0.05); g.gain.exponentialRampToValueAtTime(0.0001, AC.currentTime+1.5); src.connect(bp).connect(g).connect(master); src.start(); src.stop(AC.currentTime+1.6); }
  };

  // ------- Timeline da narrativa (Royal Lendle) -------
  const TL = [
    { t:0,   lines:[['big','Você é um aventureiro da velha guarda.'], ['mid','Pronto para empunhar sua espada por qualquer um… quase.']], sfx:()=>{ FXS.wind(true); if(A.tags.music){ A.play('music',0.35);} if(A.tags.tavern){ A.play('tavern',0.5);} } },
    { t:6,   lines:[['mid','O que você procura mesmo é a emoção da aventura.'], ['mid','E o gosto pela justiça.']] },
    { t:12,  lines:[['mid','Já lutou com muitos exércitos…'], ['mid','e fez longas expedições a terras desconhecidas.']], sfx:()=>FXS.battle() },
    { t:18,  lines:[['mid','Durante a Guerra dos Quatro Reinos,'], ['mid','lutou por Gallantaria, sua pátria.']], sfx:()=>FXS.boom() },
    { t:24,  lines:[['mid','Sua coragem e liderança renderam condecorações…'], ['mid','e o posto de comandante.']] },
    { t:30,  lines:[['mid','Terminada a guerra, deixou a fama para trás…'], ['mid','e partiu em busca de novas aventuras.']], sfx:()=>{ A.fade('tavern',0,800); } },
    { t:36,  lines:[['mid','Cinco anos se passaram.'], ['mid','Agora, você está em Royal Lendle.']], sfx:()=>FXS.wind(true) },
    { t:42,  lines:[['mid','Quatro dias na cidade… e já está entediado.'], ['mid','Então, vai até a taverna Primeiro Passo.']], sfx:()=>{ if(A.tags.tavern){ A.play('tavern',0.45);} FXS.steps(); } },
    { t:48,  lines:[['mid','Ao terminar a segunda caneca de Lendale,'], ['mid','alguém bate em seu ombro.']], sfx:()=>FXS.mug() },
    { t:54,  lines:[['mid','Um homem de rosto preocupado.'], ['mid','Camponês da região de fronteira.']] },
    { t:58,  lines:[['mid','“Por favor, Comandante… precisa nos ajudar em Karnstein.”']] },
    { t:65,  lines:[['mid','Ele fala de saques… mortes…'], ['mid','E de um inimigo impossível: o Cavaleiro das Trevas.']], sfx:()=>FXS.thunder() },
    { t:72,  lines:[['mid','Você conhece a lenda.'], ['mid','Criaturas usadas para assustar crianças.']] },
    { t:78,  lines:[['mid','Mas o terror no rosto dele é real.']] },
    { t:82,  lines:[['mid','E então você decide:']], sfx:()=>FXS.sword() },
    { t:86,  lines:[['mid','irá para Karnstein…'], ['mid','para enfrentar o que quer que esteja nas sombras.']], sfx:()=>{ FXS.wind(false); FXS.boom(); A.fade('tavern',0,1200); A.fade('music',0.25,1200);} },
  ];

  let timer=null, isRunning=false;
  function clearLines(){ linesBox.innerHTML=''; }
  function addLine([kind, html]){ const p=document.createElement('div'); p.className = `line ${kind||'mid'}`; p.innerHTML=html; linesBox.appendChild(p); requestAnimationFrame(()=>p.classList.add('show')); }

  function playTimeline(){
    spawnParticles(); clearLines(); endCta.classList.remove('show');
    const t0 = performance.now(); isRunning=true; let idx=0;
    function tick(now){ if(!isRunning) return; const elap=(now-t0)/1000; while(idx<TL.length && elap>=TL[idx].t){ const s=TL[idx++]; clearLines(); (s.lines||[]).forEach(addLine); if(s.sfx) s.sfx(); }
      if(idx>=TL.length){ endCta.classList.add('show'); isRunning=false; return; }
      timer=requestAnimationFrame(tick);
    }
    timer=requestAnimationFrame(tick);
  }

  function stopTimeline(){ isRunning=false; cancelAnimationFrame(timer); }
  function replay(){ stopTimeline(); if(A.tags.music){ A.play('music',0.35);} if(A.tags.tavern){ A.play('tavern',0.5);} playTimeline(); }
  function skip(){ stopTimeline(); clearLines(); FXS.wind(false); FXS.boom(); linesBox.innerHTML = `<div class="line big show">Você parte para Karnstein… as sombras aguardam.</div>`; endCta.classList.add('show'); }

  window.addEventListener('keydown', (e)=>{ if(gate.style.display!=='none') return; if(e.code==='Space'){ e.preventDefault(); skip(); } if(e.code==='Enter'){ e.preventDefault(); replay(); } if(e.key.toLowerCase()==='r'){ e.preventDefault(); replay(); } });
  el('#btnSkip').onclick = skip; el('#btnReplay').onclick = replay; el('#btnStart').onclick = ()=>{ window.dispatchEvent(new CustomEvent('intro:done')); };

  btnBegin.addEventListener('click', async ()=>{
    gate.style.display='none';
    if(!AC) initAudio(); await (AC?.resume?.());
    await A.load().catch(()=>{});
    if(A.tags.music){ A.play('music',0.35); }
    if(A.tags.tavern){ A.play('tavern',0.5); }
    playTimeline();
  });

  let rsT=null; window.addEventListener('resize', ()=>{ clearTimeout(rsT); rsT=setTimeout(spawnParticles, 250); });
  window.addEventListener('load', ()=> btnBegin.focus());
  </script>
</body>
</html>